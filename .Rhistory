PATH <- "C:/Users/czpkersten/Desktop/pez.csv"
table <- read_csv(PATH)
table_l <- pivot_longer(table, cols=3:10, names_to="year", values_to="value")
table_w <- pivot_wider(table_l, names_from=scenario, values_from=value)
View(table_w)
table_w %>% write_csv(OUT_PATH)
OUT_PATH <- "C:/Users/czpkersten/Desktop/pez_t.csv"
table_w %>% write_csv(OUT_PATH)
library(plyr)
library(tidyverse)
library(openxlsx)
require(googledrive)
library(gt)
#devtools::install_github("ianmoran11/mmtable2")
library(mmtable2)
library(dplyr)
library(stringr)
library(tidyr)
library(sjlabelled)
library(patchwork)
library(RColorBrewer)
library(paletteer)
library(officer)
library("colorspace")
options(scipen=100,digits=4)
if (.Platform$OS.type == 'windows') {
Sys.setlocale(category = 'LC_ALL','English_United States.1250')
} else {
Sys.setlocale(category = 'LC_ALL','en_US.UTF-8')
}
sx <- 7  # for EUA SA
#load("C:/Users/Merlijn Kersten/Documents/Univerzita Karlova/Before_Batch_Import.RData")
load("G:/Shared drives/MAKRO MODELY/TIMES/TIMES_V02+/Before_Batch_Import.RData")
path_fig <- c("C:/Users/czpkersten/Desktop")
path_tab <- c("C:/Users/czpkersten/Desktop")
##:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::batch import:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::-----
#setwd("C:/VEDA/GAMS_WrkTIMES_v02+/BEV_cars")
#setwd("C:/VEDA/GAMS_WrkTIMES_v02+/RegSim_preliminary")
setwd("C:/VEDA/GAMS_WrkTIMES")
imdir<-list.files(recursive = TRUE,pattern = ".vd")
imdvd<- imdir[str_detect(imdir,".vd$")]   # vd files
imdvde<-imdir[str_detect(imdir,".vde$")]   # vde files
#todays scenarios:
imdvd <- imdvd[str_detect(imdvd,format(Sys.Date(),"%d%m"))]
imdvde <- imdvde[str_detect(imdvde,format(Sys.Date(),"%d%m"))]
#yesterdays scenarios:
#imdvd <- imdvd[str_detect(imdvd,format(Sys.Date()-1,"%d%m"))]
#imdvde <- imdvde[str_detect(imdvde,format(Sys.Date()-1,"%d%m"))]
imdvd
imdvde
t <- NULL
for (n in 1:length(imdvd)) {
#b<-unlist(strsplit(imdvd[n],c("/"))) # ("/","[.]")))
a <- imdvd[n]%>%str_split("[.]") %>% unlist()
tt<-read.csv(imdvd[n],skip = 13,header = F)
names(tt)<-c("attribute","commodity","process","period","region","vintage","timeSlice","userConstraint","pv")
tt$scenario<-a[1] %>%str_sub(1,-6)
tt$attribute <- tt$attribute %>% as.factor()
t<-rbind(t,tt)
}
d <- NULL
for (n in 1:length(imdvde)) {
#b<-unlist(strsplit(imdvde[n],c("/"))) # ("/","[.]")))
a <- imdvde[n] %>%str_split("[.]") %>% unlist()
dd<-read.csv(imdvde[n],header = F)
names(dd)<-c("type","region","code","description")
dd$scenario<-a[1] %>%str_sub(1,-6)
dd$type <- dd$type %>% as.factor()
d<-rbind(d,dd)
}
d <- d %>% select(-region,-scenario)%>% unique()
p <- d %>% filter(type=="Process") %>% select(code,description)%>% dplyr::rename("process"="code","proc_desc"="description")
c <- d %>% filter(type=="Commodity")%>% select(code,description)%>% dplyr::rename("commodity"="code","com_desc"="description")
c$dup <- duplicated(c$commodity)
cdup <- c %>% filter(dup=="TRUE")
c <- c %>% filter(dup=="FALSE") %>% select(-dup)
t <- left_join(t,p)
t <- left_join(t,c)
#t <- rbind(t,select(nkep,names(t)))
t <- left_join(t,com[,c("commodity","unit","kg_m3","red.ii..kg_m3","red.ii..mj_kg","red.ii..mj_dm3")])
# all fuel to PJ and kt
t$pj <- ifelse(t$unit=="PJ",t$pv,NA)
t$pj <- ifelse(t$unit=="kt",t$pv*t$red.ii..mj_kg/1000,t$pj)
t$pj <- ifelse(t$unit=="m3",t$pv*t$red.ii..mj_dm3/1000000,t$pj)
t$kt <- ifelse(t$unit=="kt",t$pv,NA)
t$kt <- ifelse(t$unit=="PJ",t$pv/t$red.ii..mj_kg*1000,t$kt)
t$red.ii..kg_m3 <- t$red.ii..kg_m3 %>% as.numeric()
t$kt <- ifelse(t$unit=="m3",t$pv*t$red.ii..kg_m3/1000000,t$kt)
##---- sets ----
## commodity sets
comod <- t %>% filter(commodity!="-") %>% select(commodity)%>% unique()
comod_prim <- comod %>% filter(.,str_detect(comod$commodity,"^BIO|^COA|^GASNAT|^OIL|^RENGEO|RENWIN|RENHYD|RENSOL|^NUC|^ELCHIG")) %>% unique() %>% unlist()%>% as.vector() %>% sort()
comod_sec <- comod %>% filter(.,str_detect(comod$commodity,"^SUP|^ELC|^IND|TRALPG|TRAGSL|TRAKER|TRADST|TRAHFO|TRAGAS|TRAGH2|^COM|^RSD|^AGR"),
!str_detect(comod$commodity,"AGR$|FM|ELCHIG|ELCLOW|ELCMED")) %>% unique()
comod_sec <- comod_sec["commodity"] %>% unique()%>% unlist() %>% as.vector() %>% sort()
comod_ind <- comod %>% filter(.,str_detect(comod$commodity,"^IND")) %>% unique()
comod_ind <- comod_ind["commodity"] %>% unique()%>% unlist() %>% as.vector()
comod_pol <- comod %>% filter(.,str_detect(comod$commodity,"^PM_|^NOx_|^SOx_")) %>% unique()
comod_pol <- comod_pol["commodity"] %>% unique()%>% unlist() %>% as.vector()
comod_co2 <- comod %>% filter(.,str_detect(comod$commodity,"^C_")) %>% unique() %>% unlist()%>% as.vector() %>% sort()
comod_ch4 <- comod %>% filter(.,str_detect(comod$commodity,"^CH4_")) %>% unique() %>% unlist()%>% as.vector() %>% sort()
comod_n2o <- comod %>% filter(.,str_detect(comod$commodity,"^N2O_")) %>% unique() %>% unlist()%>% as.vector() %>% sort()
comod_ghg <- c(comod_co2,comod_ch4,comod_n2o)
gr_comod_sec <- comod_sec %>% str_sub(.,start = 4) %>% unique()
elc <- comod %>% filter (.,str_detect(comod$commodity,"ELCHIG|ELCLOW|ELCMED|INDELC"))
elc <- elc["commodity"] %>% unique()%>% unlist() %>% as.vector()
comod_heat <- comod %>% filter (.,str_detect(comod$commodity,"HET")) %>% unique() %>% unlist()%>% as.vector() %>% sort()
comod_indheat <- comod %>% filter (.,str_detect(comod$commodity,"^I"),str_detect(comod$commodity,"TH$")) %>% unique() %>% unlist()%>% as.vector() %>% sort()
heat_out <- heat["commodity"] %>% unique()%>% unlist() %>% as.vector()
heat <- comod %>% filter (.,str_detect(comod$commodity,"HTH$|LTH$"))%>% unique()%>% unlist() %>% as.vector()
comod_ren_tra <- c("FAME1G","FAMEixB","FAME2G","FAEE1G","FAEEixB","MTBE2G","ETBE1G","ETOH1G","ETOH2G","HVO1G","HVOixB",
"HVO2G","BBEN1G","BBENixB","BLPG1G","BLPGixB","BCNG2G","H22G","BMN1G","BMN2G","TRAELCR","TRAELCT")
comod_ren <- comod %>% filter(.,str_detect(comod$commodity,"^BIO|^RENGEO|RENWIN|RENHYD|RENSOL")) %>% unique() %>% unlist()%>% as.vector() %>% sort()
comod_h2 <- comod %>% filter (.,str_detect(comod$commodity,"H2"),!str_detect(comod$commodity,"^s"),commodity!="ETOH2G")%>% unique() %>% unlist()%>% as.vector() %>% sort()
comod_heat_chp <- comod %>% filter(.,str_detect(comod$commodity,"^HET"),!str_detect(comod$commodity,"TH$")) %>% unique() %>% unlist()%>% as.vector() %>% sort()
comod_ets_by <- comod %>%  filter(.,str_detect(comod$commodity,"^ets")) %>% unique()%>% unlist() %>% as.vector()
## process sets
proc_dummy <- t %>% filter(.,str_detect(t$process,"IMPDEMZ|IMPMATZ|IMPNRGZ"))
proc_dummy  <- proc_dummy ["process"] %>% unique()%>% unlist() %>% as.vector()
proc_prim <- t %>% filter(.,str_detect(t$process,"^IMP|^EXP|^MIN|^SPI|^SPR"))
gr_proc_prim <- proc_prim$process %>% str_sub(.,start = 1,end = 3) %>% unique()
proc_prim <- proc_prim["process"] %>% unique()%>% unlist() %>% as.vector()
proc_trans <- t %>% filter(.,str_detect(t$process,"TRANS"))
proc_trans  <- proc_trans ["process"] %>% unique()%>% unlist() %>% as.vector()
proc_gfec <- t %>% filter(attribute=="VAR_FIn",commodity %in% c(comod_prim,elc,"HETHTH","HETLTH","BAF","NMF"), str_detect(t$process,"00$|01$"),
!str_detect(t$process,"^NEC|^NEO|^SPIP|^SPRI|^SRET|^SSC|^STRAN|^ELC|^EU"))
proc_gfec <- proc_gfec["process"]%>% unique()%>% unlist() %>% as.vector()
proc_elc <- t %>% filter(commodity %in% elc, attribute=="VAR_FOut", process %!in% proc_trans,!str_detect(t$process,"^CC|BTRY|STG|CAES|HYDP|INDELC|IMP"))
proc_elc <- proc_elc["process"]%>% unique()%>% unlist() %>% as.vector()
proc_heat_sec <- t %>% filter(attribute=="VAR_FIn",commodity %in% c("HETHTH","HETLTH"), str_detect(t$process,"00$|01$"))
proc_heat_sec <- proc_heat_sec["process"]%>% unique()%>% unlist() %>% as.vector()
proc_gas_dist <- t %>% filter(attribute=="VAR_FIn",commodity=="GASNAT", process!="NECDEMAND00" ) %>% select(process)%>% unique() %>% unlist() %>% as.vector()
proc_res_e <- t %>% filter(.,str_detect(t$process,"EUHYD|PVSOL|EUWIN|EUGEO|PUGEO|EUFSC|EAUTHYD|EAUTSOL|EAUTWIN|EAUTGEO"),
!str_detect(t$process,"^CC|BTRY|STG|CAES|HYDPS|HYDPUMP"))
proc_res_e <- proc_res_e["process"]%>% unique()%>% unlist() %>% as.vector()
proc_bio_elc <- ta %>% filter(str_detect(ta$process,"BGS|BIO|WOO"),str_detect(ta$commodity,"ELCLOW|ELCMED|ELCHIG|INDELC|COMELC"),attribute=="VAR_FOut")
proc_bio_elc <- proc_bio_elc["process"]%>% unique()%>% unlist() %>% as.vector()
proc_mun_elc <- ta %>% filter(str_detect(ta$process,"MUN|WST"),str_detect(ta$commodity,"ELCLOW|ELCMED|ELCHIG|INDELC|COMELC"),attribute=="VAR_FOut")
proc_mun_elc <- proc_mun_elc["process"]%>% unique()%>% unlist() %>% as.vector()
proc_bio_heat <- ta %>% filter(str_detect(ta$process,"BGS|BIO|WOO"),str_detect(ta$commodity,"HTH|LTH"),attribute=="VAR_FOut")%>% unique()%>% unlist() %>% as.vector()
proc_indbio <- ta %>% filter(commodity=="INDBIO",attribute=="VAR_FIn")
proc_indbio <- proc_indbio["process"]%>% unique()%>% unlist() %>% as.vector()
proc_crf_com <- ta %>% filter(str_detect(ta$commodity,"^C_"),attribute=="VAR_FOut") %>% select(process,commodity) %>% unique() %>%
filter(commodity!="C_tech", !(process=="ICH6"& commodity=="C_1A4ai"))
proc_crf_com$crf <- proc_crf_com$commodity %>% str_sub(3,8)
proc_crf_com$crf_short <- case_when(str_detect(proc_crf_com$crf,"1A1")~ "1A1",
str_detect(proc_crf_com$crf,"1A4")~ "1A4",
str_detect(proc_crf_com$crf,"1B")~ "1B",
str_detect(proc_crf_com$crf,"^2")~ "2",
TRUE~ proc_crf_com$crf)
proc_crf_com <- proc_crf_com %>% select(-commodity)
proc_crf <- proc_crf_com ["process"]%>% unique()%>% unlist() %>% as.vector()
proc_cghg <- ta %>% filter(commodity=="CGHG",attribute=="VAR_FOut") %>% select(process) %>% unique()%>% unlist() %>% as.vector()
proc_Troad <- c(proc_TBUS,proc_TCARS,proc_TCOACH,proc_TLUV,proc_TMOT,proc_TNA)
proc_imp_exp <- c(proc_IMPORT_PR,proc_EXPORT_PR)
comod_prim
comod_sec
proc_prim
proc_h2 <- ta %>% filter(commodity %in% comod_h2,attribute=="VAR_FOut", !process %>% str_detect('^ST|P_ST')) %>% select(process) %>% unique()%>% unlist() %>% as.vector()
gr_comod_sec
gr_proc_prim
att_cost <- t$attribute %>% unique() %>%  str_subset(.,"Cost")
att_varM <- t$attribute %>% unique() %>%  str_subset(.,"VAR_") %>%  str_subset(.,"M$")
att_var <- t$attribute %>% unique() %>%  str_subset(.,"VAR_")
att_var <- att_var[att_var %!in% att_varM]
att_io <- c('VAR_FIn','VAR_FOut')
t$attribute %>% as.character()%>% filter(!str_detect(t$attribute,"M$"),str_detect(t$attribute,"VAR_"))
#size of x axis text
sx <- 7  # for EUA SA
elc_out <- flow %>%  filter(.,process %!in% proc_trans,commodity %in% elc, attribute=="VAR_FOut",sec2!="Fuel tech", process!="IMPELCHIGA") #%>% mutate_if(is.numeric, round, digits=2)
elc_outt <- elc_out  %>% select(period,scenario,unit,pv)%>%
group_by(period,scenario,unit)  %>% summarise_all(.,sum,na.rm=TRUE) %>% as.data.frame()
elc_outt$TWh <- elc_outt$pv/3.6
elc_outt <- elc_outt %>% mutate_if(is.numeric, round, digits=1)
#net elc production
f_elc_out <-
elc_outt %>% ggplot(aes(x=period,y=TWh, colour= scenario, shape=scenario,group=scenario)) + geom_line(size=0.75)  +geom_point(size=2)+
labs(y="TWh",
shape='Scénář',
group='Scénář',
colour='Scénář',
title= "Výroba elektřiny",
subtitle = 'bez vlastní spotřeby na výrobu elektřiny a tepla')+
scale_fill_brewer(palette = "Set1", direction = 1)+
theme_bw()+
theme(axis.text.x = element_text(angle=90,size=sx),
axis.text.y = element_text(size=12),
legend.text = element_text(size=12),
axis.title.x = element_blank())
f_elc_out
# ---- Create PES graph
pes <- t[,c(1:4,9:10,13)] %>% filter(.,process %in% proc_prim|process %>% str_detect('SINKCB'),process!='SPRIOIL100',commodity %in% comod_prim|commodity %>% str_detect('AHT'),commodity!='OILPIP', str_detect(t$attribute,"^VAR_F"),!(process=='SINKCB1'& commodity=='ELCHIGG')) %>%
group_by(.,attribute,commodity,process,period,scenario,unit) %>% summarise_all(.,sum,na.rm=TRUE) %>% as.data.frame()
pes$gr_proc <- pes$process %>% str_sub(.,start = 1, end = 3)
pes <- pes %>% filter(.,gr_proc %in% gr_proc_prim|gr_proc=='SIN')
# negative to export, ELCHIGG to ELCHIG
pes$pv <- ifelse(pes$gr_proc=="EXP",pes$pv*(-1),pes$pv)
pes$commodity <- ifelse(pes$commodity=="ELCHIGG","ELCHIG",pes$commodity)
table(pes$commodity)
table(pes$gr_proc)
pes_com <- pes %>% select(.,-process,-gr_proc, -attribute)%>%
group_by(.,period,scenario,commodity,unit) %>% summarise_all(.,sum,na.rm=TRUE) %>% as.data.frame()
pes_com_w <- pes_com %>% pivot_wider(names_from = c("scenario","period"), values_from = pv)
pes_com_w <- pes_com_w[,order(names(pes_com_w))]
pes_com$PEZ <- case_when(str_detect(pes_com$commodity,"BIO") ~ "Biomasa a bioplyn",
str_detect(pes_com$commodity,"COAH|COAC") ~ "Černé uhlí a koks",
str_detect(pes_com$commodity,"COAL|COAB") ~ "Hnědé uhlí",
str_detect(pes_com$commodity,"OIL") ~ "Kapalná paliva",
str_detect(pes_com$commodity,"GAS") ~ "Zemní plyn",
str_detect(pes_com$commodity,"NUC") ~ "Jaderné teplo",
str_detect(pes_com$commodity,"HYD") ~ "Vodní",
str_detect(pes_com$commodity,"WIN") ~ "Větrná",
str_detect(pes_com$commodity,"SOL") ~ "Solární",
str_detect(pes_com$commodity,"GEO") ~ "Geothermální",
str_detect(pes_com$commodity,"ELC") ~ "Elektřina - čistý import",
str_detect(pes_com$commodity,"AHT") ~ 'Energie prostředí')
pes_cg <- pes_com %>% select(.,-commodity)%>%
group_by(.,period,scenario,PEZ,unit) %>% summarise_all(.,sum,na.rm=TRUE) %>% as.data.frame() %>% mutate_if(is.numeric, round, digits=1)
pes_tot <- pes_com %>% select(.,-commodity,-PEZ)%>%
group_by(.,period,scenario,unit) %>% summarise_all(.,sum,na.rm=TRUE) %>% pivot_wider(names_from = period,values_from = pv)
pes_tot$pr2050_15 <- pes_tot$`2050`/pes_tot$`2015`
pes_tot$save2050_15 <- 1-pes_tot$pr2050_15
# palette :      Bioplyn,  Biomasa,  Geoterm,    Hydro ,   FVE,      VTE
PaletteRES <- c("#A4F042","#009E73","#CC79A7","#56B4E9","#FFBF2A","#0072B2")
# palette :      BIO,       HC,     ELC     AHT   liqiud ,GEO,        BC ,  NUC,       FVE,      VTE,    Hydro, GASNAT,
PalettePES <- c("#009E73","black",'magenta','seashell',"#CC79A7",'saddlebrown','cyan',"red","#FFBF2A","#56B4E9","#0072B2",'yellow')
#'darkorchid1'
colourCount = length(unique(pes_cg$PEZ))
getPalette = colorRampPalette(brewer.pal(9, "Set1"))
f_pez <-
pes_cg %>%
ggplot(aes(x=scenario)) + geom_col(aes(y=pv, fill=PEZ)) +
labs (y ="PJ",
x='Scénář',
title= "SPOTŘEBA PRIMÁRNÍCH ENERGETICKÝCH ZDROJŮ",
fill= "PEZ")+
facet_grid(~period)+
theme_bw()+
theme(axis.text.x = element_text(angle=90,size=sx),
axis.text.y = element_text(size=12),
# legend.position = "bottom",                  # pro EUA SA
legend.title = element_text((size=12)),
legend.text = element_text(size=11))+
scale_fill_manual(values = PalettePES,
name="Primární energetické\nzdroje")+
scale_y_continuous (breaks = scales::pretty_breaks(n = 8))
ggsave(filename = "PEZ.png",device = "png", width = 10, height = 7.49,units = "in", dpi = 150,path = path_fig)
f_pez
row_list <- cells_body(rows = c(1,1:length(unique(t$scenario))*length(unique(pes_cg$PEZ))+1))
style_list <- list(cell_borders(sides = "bottom",color = "grey"))
t_pez <-
pes_cg %>%
mmtable(cells = pv)+
header_left(PEZ)+
header_left_top(scenario)+
header_top(period)+
table_format(locations = row_list,style = style_list)+
table_title("Spotřeba primárních energetických zdrojů [PJ]")
t_pez
gtsave(apply_formats(t_pez), filename = "t01_pez.html")
library(plyr)
library(tidyverse)
library(openxlsx)
require(googledrive)
library(gt)
#devtools::install_github("ianmoran11/mmtable2")
library(mmtable2)
library(dplyr)
library(stringr)
library(tidyr)
library(sjlabelled)
library(patchwork)
library(RColorBrewer)
library(paletteer)
library(officer)
library("colorspace")
options(scipen=100,digits=4)
if (.Platform$OS.type == 'windows') {
Sys.setlocale(category = 'LC_ALL','English_United States.1250')
} else {
Sys.setlocale(category = 'LC_ALL','en_US.UTF-8')
}
sx <- 7  # for EUA SA
#load("C:/Users/Merlijn Kersten/Documents/Univerzita Karlova/Before_Batch_Import.RData")
load("G:/Shared drives/MAKRO MODELY/TIMES/TIMES_V02+/Before_Batch_Import.RData")
path_fig <- c("C:/Users/czpkersten/Desktop")
path_tab <- c("C:/Users/czpkersten/Desktop")
##:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::batch import:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::-----
#setwd("C:/VEDA/GAMS_WrkTIMES_v02+/BEV_cars")
#setwd("C:/VEDA/GAMS_WrkTIMES_v02+/RegSim_preliminary")
setwd("C:/VEDA/GAMS_WrkTIMES")
imdir<-list.files(recursive = TRUE,pattern = ".vd")
imdvd<- imdir[str_detect(imdir,".vd$")]   # vd files
imdvde<-imdir[str_detect(imdir,".vde$")]   # vde files
#todays scenarios:
imdvd <- imdvd[str_detect(imdvd,format(Sys.Date(),"%d%m"))]
imdvde <- imdvde[str_detect(imdvde,format(Sys.Date(),"%d%m"))]
#yesterdays scenarios:
#imdvd <- imdvd[str_detect(imdvd,format(Sys.Date()-1,"%d%m"))]
#imdvde <- imdvde[str_detect(imdvde,format(Sys.Date()-1,"%d%m"))]
imdvd
imdvde
t <- NULL
for (n in 1:length(imdvd)) {
#b<-unlist(strsplit(imdvd[n],c("/"))) # ("/","[.]")))
a <- imdvd[n]%>%str_split("[.]") %>% unlist()
tt<-read.csv(imdvd[n],skip = 13,header = F)
names(tt)<-c("attribute","commodity","process","period","region","vintage","timeSlice","userConstraint","pv")
tt$scenario<-a[1] %>%str_sub(1,-6)
tt$attribute <- tt$attribute %>% as.factor()
t<-rbind(t,tt)
}
d <- NULL
for (n in 1:length(imdvde)) {
#b<-unlist(strsplit(imdvde[n],c("/"))) # ("/","[.]")))
a <- imdvde[n] %>%str_split("[.]") %>% unlist()
dd<-read.csv(imdvde[n],header = F)
names(dd)<-c("type","region","code","description")
dd$scenario<-a[1] %>%str_sub(1,-6)
dd$type <- dd$type %>% as.factor()
d<-rbind(d,dd)
}
d <- d %>% select(-region,-scenario)%>% unique()
p <- d %>% filter(type=="Process") %>% select(code,description)%>% dplyr::rename("process"="code","proc_desc"="description")
c <- d %>% filter(type=="Commodity")%>% select(code,description)%>% dplyr::rename("commodity"="code","com_desc"="description")
c$dup <- duplicated(c$commodity)
cdup <- c %>% filter(dup=="TRUE")
c <- c %>% filter(dup=="FALSE") %>% select(-dup)
t <- left_join(t,p)
t <- left_join(t,c)
#t <- rbind(t,select(nkep,names(t)))
t <- left_join(t,com[,c("commodity","unit","kg_m3","red.ii..kg_m3","red.ii..mj_kg","red.ii..mj_dm3")])
# all fuel to PJ and kt
t$pj <- ifelse(t$unit=="PJ",t$pv,NA)
t$pj <- ifelse(t$unit=="kt",t$pv*t$red.ii..mj_kg/1000,t$pj)
t$pj <- ifelse(t$unit=="m3",t$pv*t$red.ii..mj_dm3/1000000,t$pj)
t$kt <- ifelse(t$unit=="kt",t$pv,NA)
t$kt <- ifelse(t$unit=="PJ",t$pv/t$red.ii..mj_kg*1000,t$kt)
t$red.ii..kg_m3 <- t$red.ii..kg_m3 %>% as.numeric()
t$kt <- ifelse(t$unit=="m3",t$pv*t$red.ii..kg_m3/1000000,t$kt)
##---- sets ----
## commodity sets
comod <- t %>% filter(commodity!="-") %>% select(commodity)%>% unique()
comod_prim <- comod %>% filter(.,str_detect(comod$commodity,"^BIO|^COA|^GASNAT|^OIL|^RENGEO|RENWIN|RENHYD|RENSOL|^NUC|^ELCHIG")) %>% unique() %>% unlist()%>% as.vector() %>% sort()
comod_sec <- comod %>% filter(.,str_detect(comod$commodity,"^SUP|^ELC|^IND|TRALPG|TRAGSL|TRAKER|TRADST|TRAHFO|TRAGAS|TRAGH2|^COM|^RSD|^AGR"),
!str_detect(comod$commodity,"AGR$|FM|ELCHIG|ELCLOW|ELCMED")) %>% unique()
comod_sec <- comod_sec["commodity"] %>% unique()%>% unlist() %>% as.vector() %>% sort()
comod_ind <- comod %>% filter(.,str_detect(comod$commodity,"^IND")) %>% unique()
comod_ind <- comod_ind["commodity"] %>% unique()%>% unlist() %>% as.vector()
comod_pol <- comod %>% filter(.,str_detect(comod$commodity,"^PM_|^NOx_|^SOx_")) %>% unique()
comod_pol <- comod_pol["commodity"] %>% unique()%>% unlist() %>% as.vector()
comod_co2 <- comod %>% filter(.,str_detect(comod$commodity,"^C_")) %>% unique() %>% unlist()%>% as.vector() %>% sort()
comod_ch4 <- comod %>% filter(.,str_detect(comod$commodity,"^CH4_")) %>% unique() %>% unlist()%>% as.vector() %>% sort()
comod_n2o <- comod %>% filter(.,str_detect(comod$commodity,"^N2O_")) %>% unique() %>% unlist()%>% as.vector() %>% sort()
comod_ghg <- c(comod_co2,comod_ch4,comod_n2o)
gr_comod_sec <- comod_sec %>% str_sub(.,start = 4) %>% unique()
elc <- comod %>% filter (.,str_detect(comod$commodity,"ELCHIG|ELCLOW|ELCMED|INDELC"))
elc <- elc["commodity"] %>% unique()%>% unlist() %>% as.vector()
comod_heat <- comod %>% filter (.,str_detect(comod$commodity,"HET")) %>% unique() %>% unlist()%>% as.vector() %>% sort()
comod_indheat <- comod %>% filter (.,str_detect(comod$commodity,"^I"),str_detect(comod$commodity,"TH$")) %>% unique() %>% unlist()%>% as.vector() %>% sort()
heat_out <- heat["commodity"] %>% unique()%>% unlist() %>% as.vector()
heat <- comod %>% filter (.,str_detect(comod$commodity,"HTH$|LTH$"))%>% unique()%>% unlist() %>% as.vector()
comod_ren_tra <- c("FAME1G","FAMEixB","FAME2G","FAEE1G","FAEEixB","MTBE2G","ETBE1G","ETOH1G","ETOH2G","HVO1G","HVOixB",
"HVO2G","BBEN1G","BBENixB","BLPG1G","BLPGixB","BCNG2G","H22G","BMN1G","BMN2G","TRAELCR","TRAELCT")
comod_ren <- comod %>% filter(.,str_detect(comod$commodity,"^BIO|^RENGEO|RENWIN|RENHYD|RENSOL")) %>% unique() %>% unlist()%>% as.vector() %>% sort()
comod_h2 <- comod %>% filter (.,str_detect(comod$commodity,"H2"),!str_detect(comod$commodity,"^s"),commodity!="ETOH2G")%>% unique() %>% unlist()%>% as.vector() %>% sort()
comod_heat_chp <- comod %>% filter(.,str_detect(comod$commodity,"^HET"),!str_detect(comod$commodity,"TH$")) %>% unique() %>% unlist()%>% as.vector() %>% sort()
comod_ets_by <- comod %>%  filter(.,str_detect(comod$commodity,"^ets")) %>% unique()%>% unlist() %>% as.vector()
## process sets
proc_dummy <- t %>% filter(.,str_detect(t$process,"IMPDEMZ|IMPMATZ|IMPNRGZ"))
proc_dummy  <- proc_dummy ["process"] %>% unique()%>% unlist() %>% as.vector()
proc_prim <- t %>% filter(.,str_detect(t$process,"^IMP|^EXP|^MIN|^SPI|^SPR"))
gr_proc_prim <- proc_prim$process %>% str_sub(.,start = 1,end = 3) %>% unique()
proc_prim <- proc_prim["process"] %>% unique()%>% unlist() %>% as.vector()
proc_trans <- t %>% filter(.,str_detect(t$process,"TRANS"))
proc_trans  <- proc_trans ["process"] %>% unique()%>% unlist() %>% as.vector()
proc_gfec <- t %>% filter(attribute=="VAR_FIn",commodity %in% c(comod_prim,elc,"HETHTH","HETLTH","BAF","NMF"), str_detect(t$process,"00$|01$"),
!str_detect(t$process,"^NEC|^NEO|^SPIP|^SPRI|^SRET|^SSC|^STRAN|^ELC|^EU"))
proc_gfec <- proc_gfec["process"]%>% unique()%>% unlist() %>% as.vector()
proc_elc <- t %>% filter(commodity %in% elc, attribute=="VAR_FOut", process %!in% proc_trans,!str_detect(t$process,"^CC|BTRY|STG|CAES|HYDP|INDELC|IMP"))
proc_elc <- proc_elc["process"]%>% unique()%>% unlist() %>% as.vector()
proc_heat_sec <- t %>% filter(attribute=="VAR_FIn",commodity %in% c("HETHTH","HETLTH"), str_detect(t$process,"00$|01$"))
proc_heat_sec <- proc_heat_sec["process"]%>% unique()%>% unlist() %>% as.vector()
proc_gas_dist <- t %>% filter(attribute=="VAR_FIn",commodity=="GASNAT", process!="NECDEMAND00" ) %>% select(process)%>% unique() %>% unlist() %>% as.vector()
proc_res_e <- t %>% filter(.,str_detect(t$process,"EUHYD|PVSOL|EUWIN|EUGEO|PUGEO|EUFSC|EAUTHYD|EAUTSOL|EAUTWIN|EAUTGEO"),
!str_detect(t$process,"^CC|BTRY|STG|CAES|HYDPS|HYDPUMP"))
proc_res_e <- proc_res_e["process"]%>% unique()%>% unlist() %>% as.vector()
proc_bio_elc <- ta %>% filter(str_detect(ta$process,"BGS|BIO|WOO"),str_detect(ta$commodity,"ELCLOW|ELCMED|ELCHIG|INDELC|COMELC"),attribute=="VAR_FOut")
proc_bio_elc <- proc_bio_elc["process"]%>% unique()%>% unlist() %>% as.vector()
proc_mun_elc <- ta %>% filter(str_detect(ta$process,"MUN|WST"),str_detect(ta$commodity,"ELCLOW|ELCMED|ELCHIG|INDELC|COMELC"),attribute=="VAR_FOut")
proc_mun_elc <- proc_mun_elc["process"]%>% unique()%>% unlist() %>% as.vector()
proc_bio_heat <- ta %>% filter(str_detect(ta$process,"BGS|BIO|WOO"),str_detect(ta$commodity,"HTH|LTH"),attribute=="VAR_FOut")%>% unique()%>% unlist() %>% as.vector()
proc_indbio <- ta %>% filter(commodity=="INDBIO",attribute=="VAR_FIn")
proc_indbio <- proc_indbio["process"]%>% unique()%>% unlist() %>% as.vector()
proc_crf_com <- ta %>% filter(str_detect(ta$commodity,"^C_"),attribute=="VAR_FOut") %>% select(process,commodity) %>% unique() %>%
filter(commodity!="C_tech", !(process=="ICH6"& commodity=="C_1A4ai"))
proc_crf_com$crf <- proc_crf_com$commodity %>% str_sub(3,8)
proc_crf_com$crf_short <- case_when(str_detect(proc_crf_com$crf,"1A1")~ "1A1",
str_detect(proc_crf_com$crf,"1A4")~ "1A4",
str_detect(proc_crf_com$crf,"1B")~ "1B",
str_detect(proc_crf_com$crf,"^2")~ "2",
TRUE~ proc_crf_com$crf)
proc_crf_com <- proc_crf_com %>% select(-commodity)
proc_crf <- proc_crf_com ["process"]%>% unique()%>% unlist() %>% as.vector()
proc_cghg <- ta %>% filter(commodity=="CGHG",attribute=="VAR_FOut") %>% select(process) %>% unique()%>% unlist() %>% as.vector()
proc_Troad <- c(proc_TBUS,proc_TCARS,proc_TCOACH,proc_TLUV,proc_TMOT,proc_TNA)
proc_imp_exp <- c(proc_IMPORT_PR,proc_EXPORT_PR)
comod_prim
comod_sec
proc_prim
proc_h2 <- ta %>% filter(commodity %in% comod_h2,attribute=="VAR_FOut", !process %>% str_detect('^ST|P_ST')) %>% select(process) %>% unique()%>% unlist() %>% as.vector()
gr_comod_sec
gr_proc_prim
att_cost <- t$attribute %>% unique() %>%  str_subset(.,"Cost")
att_varM <- t$attribute %>% unique() %>%  str_subset(.,"VAR_") %>%  str_subset(.,"M$")
att_var <- t$attribute %>% unique() %>%  str_subset(.,"VAR_")
att_var <- att_var[att_var %!in% att_varM]
att_io <- c('VAR_FIn','VAR_FOut')
t$attribute %>% as.character()%>% filter(!str_detect(t$attribute,"M$"),str_detect(t$attribute,"VAR_"))
#size of x axis text
sx <- 7  # for EUA SA
elc_out <- flow %>%  filter(.,process %!in% proc_trans,commodity %in% elc, attribute=="VAR_FOut",sec2!="Fuel tech", process!="IMPELCHIGA") #%>% mutate_if(is.numeric, round, digits=2)
elc_outt <- elc_out  %>% select(period,scenario,unit,pv)%>%
group_by(period,scenario,unit)  %>% summarise_all(.,sum,na.rm=TRUE) %>% as.data.frame()
elc_outt$TWh <- elc_outt$pv/3.6
elc_outt <- elc_outt %>% mutate_if(is.numeric, round, digits=1)
#net elc production
f_elc_out <-
elc_outt %>% ggplot(aes(x=period,y=TWh, colour= scenario, shape=scenario,group=scenario)) + geom_line(size=0.75)  +geom_point(size=2)+
labs(y="TWh",
shape='Scénář',
group='Scénář',
colour='Scénář',
title= "Výroba elektřiny",
subtitle = 'bez vlastní spotřeby na výrobu elektřiny a tepla')+
scale_fill_brewer(palette = "Set1", direction = 1)+
theme_bw()+
theme(axis.text.x = element_text(angle=90,size=sx),
axis.text.y = element_text(size=12),
legend.text = element_text(size=12),
axis.title.x = element_blank())
f_elc_out
# ---- Create PES graph
pes <- t[,c(1:4,9:10,13)] %>% filter(.,process %in% proc_prim|process %>% str_detect('SINKCB'),process!='SPRIOIL100',commodity %in% comod_prim|commodity %>% str_detect('AHT'),commodity!='OILPIP', str_detect(t$attribute,"^VAR_F"),!(process=='SINKCB1'& commodity=='ELCHIGG')) %>%
group_by(.,attribute,commodity,process,period,scenario,unit) %>% summarise_all(.,sum,na.rm=TRUE) %>% as.data.frame()
pes$gr_proc <- pes$process %>% str_sub(.,start = 1, end = 3)
pes <- pes %>% filter(.,gr_proc %in% gr_proc_prim|gr_proc=='SIN')
# negative to export, ELCHIGG to ELCHIG
pes$pv <- ifelse(pes$gr_proc=="EXP",pes$pv*(-1),pes$pv)
pes$commodity <- ifelse(pes$commodity=="ELCHIGG","ELCHIG",pes$commodity)
table(pes$commodity)
table(pes$gr_proc)
pes_com <- pes %>% select(.,-process,-gr_proc, -attribute)%>%
group_by(.,period,scenario,commodity,unit) %>% summarise_all(.,sum,na.rm=TRUE) %>% as.data.frame()
pes_com_w <- pes_com %>% pivot_wider(names_from = c("scenario","period"), values_from = pv)
pes_com_w <- pes_com_w[,order(names(pes_com_w))]
pes_com$PEZ <- case_when(str_detect(pes_com$commodity,"BIO") ~ "Biomasa a bioplyn",
str_detect(pes_com$commodity,"COAH|COAC") ~ "Černé uhlí a koks",
str_detect(pes_com$commodity,"COAL|COAB") ~ "Hnědé uhlí",
str_detect(pes_com$commodity,"OIL") ~ "Kapalná paliva",
str_detect(pes_com$commodity,"GAS") ~ "Zemní plyn",
str_detect(pes_com$commodity,"NUC") ~ "Jaderné teplo",
str_detect(pes_com$commodity,"HYD") ~ "Vodní",
str_detect(pes_com$commodity,"WIN") ~ "Větrná",
str_detect(pes_com$commodity,"SOL") ~ "Solární",
str_detect(pes_com$commodity,"GEO") ~ "Geothermální",
str_detect(pes_com$commodity,"ELC") ~ "Elektřina - čistý import",
str_detect(pes_com$commodity,"AHT") ~ 'Energie prostředí')
pes_cg <- pes_com %>% select(.,-commodity)%>%
group_by(.,period,scenario,PEZ,unit) %>% summarise_all(.,sum,na.rm=TRUE) %>% as.data.frame() %>% mutate_if(is.numeric, round, digits=1)
pes_tot <- pes_com %>% select(.,-commodity,-PEZ)%>%
group_by(.,period,scenario,unit) %>% summarise_all(.,sum,na.rm=TRUE) %>% pivot_wider(names_from = period,values_from = pv)
pes_tot$pr2050_15 <- pes_tot$`2050`/pes_tot$`2015`
pes_tot$save2050_15 <- 1-pes_tot$pr2050_15
# palette :      Bioplyn,  Biomasa,  Geoterm,    Hydro ,   FVE,      VTE
PaletteRES <- c("#A4F042","#009E73","#CC79A7","#56B4E9","#FFBF2A","#0072B2")
# palette :      BIO,       HC,     ELC     AHT   liqiud ,GEO,        BC ,  NUC,       FVE,      VTE,    Hydro, GASNAT,
PalettePES <- c("#009E73","black",'magenta','seashell',"#CC79A7",'saddlebrown','cyan',"red","#FFBF2A","#56B4E9","#0072B2",'yellow')
#'darkorchid1'
colourCount = length(unique(pes_cg$PEZ))
getPalette = colorRampPalette(brewer.pal(9, "Set1"))
f_pez <-
pes_cg %>%
ggplot(aes(x=scenario)) + geom_col(aes(y=pv, fill=PEZ)) +
labs (y ="PJ",
x='Scénář',
title= "SPOTŘEBA PRIMÁRNÍCH ENERGETICKÝCH ZDROJŮ",
fill= "PEZ")+
facet_grid(~period)+
theme_bw()+
theme(axis.text.x = element_text(angle=90,size=sx),
axis.text.y = element_text(size=12),
# legend.position = "bottom",                  # pro EUA SA
legend.title = element_text((size=12)),
legend.text = element_text(size=11))+
scale_fill_manual(values = PalettePES,
name="Primární energetické\nzdroje")+
scale_y_continuous (breaks = scales::pretty_breaks(n = 8))
ggsave(filename = "PEZ.png",device = "png", width = 10, height = 7.49,units = "in", dpi = 150,path = path_fig)
f_pez
row_list <- cells_body(rows = c(1,1:length(unique(t$scenario))*length(unique(pes_cg$PEZ))+1))
style_list <- list(cell_borders(sides = "bottom",color = "grey"))
t_pez <-
pes_cg %>%
mmtable(cells = pv)+
header_left(PEZ)+
header_left_top(scenario)+
header_top(period)+
table_format(locations = row_list,style = style_list)+
table_title("Spotřeba primárních energetických zdrojů [PJ]")
t_pez
gtsave(apply_formats(t_pez), filename = "t01_pez.html")
